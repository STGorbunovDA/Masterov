@page "/search"
@using Masterov.Web.Models.FinishedProduct
@using Masterov.Web.Services
@inject NavigationManager Nav
@inject FinishedProductSearchService SearchService

@if (_products is null)
{
    <p>Загрузка...</p>
}
else if (_products.Count == 0)
{
    <p>Ничего не найдено.</p>
}
else
{
    foreach (var p in _products)
    {
        <div class="product-card">
            <h3>@p.Name</h3>
            <p>Тип: @p.Type</p>
            <p>Цена: @p.Price руб.</p>

            @if (p.Image != null)
            {
                <img src="data:image/png;base64,@Convert.ToBase64String(p.Image)" />
            }
        </div>
    }
}

@code {
    private List<FinishedProductDto>? _products;

    protected override async Task OnInitializedAsync()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);

        var q = query["q"];
        var type = query["type"];

        if (!string.IsNullOrEmpty(q))
            _products = (await SearchService.SearchByName(q)).ToList();
        else if (!string.IsNullOrEmpty(type))
            _products = (await SearchService.SearchByType(type)).ToList();
        else
            _products = new();
    }
}
